# PRD-Engine System — ארכיטקטורה מלאה

> מדריך ויזואלי שמסביר איך PRD-Engine עובד מאחורי הקלעים.
> גרסה: 2.1.0 | תאריך: פברואר 2026

---

## 🔗 איך הכל מתחבר

```
┌──────────────────────────────────────────────────────┐
│                                                      │
│            🤖 CLAUDE  (אני)                          │
│            ה-Orchestrator הראשי                       │
│                                                      │
│   קורא: CLAUDE.md → יודע את כל הכללים והקונטקסט     │
│                                                      │
└──────────────────────┬───────────────────────────────┘
                       │
          ┌────────────┼────────────┐
          │            │            │
          ▼            ▼            ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│  🎩 PM       │ │ 🎩 Architect │ │ 🎩 Frontend  │
│  (Product    │ │  (Backend)   │ │    (UI)      │
│   Manager)   │ │              │ │              │
│              │ │              │ │              │
│ זה לא סוכן  │ │  זה לא סוכן │ │  זה לא סוכן │
│ נפרד - זה   │ │  נפרד - זה  │ │  נפרד - זה  │
│ "כובע" שאני │ │ "כובע" שאני │ │ "כובע" שאני │
│ שם על עצמי  │ │ שם על עצמי  │ │ שם על עצמי  │
└──────────────┘ └──────────────┘ └──────────────┘
```

**הרעיון:** Claude הוא מוח אחד שמחליף "כובעים". כשהוא PM — הוא שואל שאלות עסקיות. כשהוא Architect — שאלות טכניות. כשהוא Frontend — שאלות UI/UX. אבל תמיד אותו Claude.

---

## 🎩 PM / Architect / Frontend = "כובעים", לא סוכנים נפרדים

**הבנה חשובה:** כשאני "PM", אני לא מפעיל סוכן אחר — אני פשוט קורא את ה-SKILL.md של PM ומתנהג לפיו.

```
משתמש: "בוא נאפיין מערכת Login"
    │
    ▼
אני (Claude): קורא product-manager/SKILL.md
    │
    ▼
שואל 9 שאלות עסקיות: "אני עכשיו PM"
    │
    ▼
🎩 "עוברים ל-Architect!"
אני (Claude): קורא architect/SKILL.md
    │
    ▼
שואל 8 שאלות טכניות: "אני עכשיו Architect"
    │
    ▼
🎩 "עוברים ל-Frontend!"
אני (Claude): קורא frontend/SKILL.md
    │
    ▼
שואל 11+1 שאלות UI: "אני עכשיו Frontend"
    │
    ▼
וכך הלאה ...
```

**למה זה חשוב?** כי כל ה-context נשאר אצלי. אני זוכר מה PM שאל, ואני יכול לשלב את זה כש-Architect שואל. אין "העברת מידע" בין סוכנים — הכל אצלי.

---

## 🔧 Sub-Agents (Task Tool) = משהו אחר לגמרי!

Sub-Agent הוא כן סוכן נפרד שרץ במקביל:

```
┌──────────────────────────────────────────────────────┐
│              🤖 CLAUDE  (אני)                        │
│              Context Window: 200K tokens             │
└──────────────────────┬───────────────────────────────┘
                       │
          ┌────────────┼────────────┐
          │            │            │
          ▼            ▼            ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│ Sub-Agent 1  │ │ Sub-Agent 2  │ │ Sub-Agent 3  │
│              │ │              │ │              │
│ "מצא מה     │ │ "בדוק את    │ │ "חקור       │
│  יש ב       │ │  ה-API של   │ │  דוגמאות    │
│  epics/"    │ │  המתחרים"   │ │  דומות"     │
│              │ │              │ │              │
│ Context      │ │ Context      │ │ Context      │
│ נפרד!       │ │ נפרד!       │ │ נפרד!       │
└──────┬───────┘ └──────┬───────┘ └──────┬───────┘
       │                │                │
       └────────────────┼────────────────┘
                        │
                        ▼
              מחזירים לי תוצאות
          (ה-Context שלי נשאר נקי!)
```

**למה זה טוב?**
- ה-Context הראשי שלי לא מתמלא ב"זבל" של מחקר
- Sub-Agents יכולים לרוץ במקביל
- כל אחד מקבל Context נקי משלו

**כלל ברזל:** כל סאב-אייגנט חייב `model: "sonnet"` — אף פעם לא Haiku, אף פעם לא Opus!

**4 תרחישים שחייבים סאב-אייגנט:**

| # | תרחיש | סוג | מה עושה |
|---|--------|-----|---------|
| 1 | תחילת Session / אחרי compact | `Explore` | קורא כל הקבצים + מחזיר סיכום 60 שורות |
| 2 | קריאת מסמך מקור (DOC_SOURCE) | `Explore` | קורא מסמך גדול + מחזיר סיכום דרישות |
| 3 | בדיקת קישורים בין epics | `Explore` | בודק epics קיימים + מזהה חפיפות |
| 4 | Cross-Review צולב | `general-purpose` | מנתח סתירות בין 3 ה-Agents |

---

## 📄 DOC_SOURCE = מסמך המקור

**בתחילת כל אפיון חדש**, המשתמש מספק קישור למסמך הדרישות שלו (Google Doc, Notion, וכו׳).

```
┌──────────────────────────────────────────────────────┐
│                                                      │
│  📄 DOC_SOURCE = קריאה בלבד!                        │
│                                                      │
│  • זה ה"מקור האמת" של הדרישות                       │
│  • אסור לשנות — כי זה מה שהמשתמש הביא              │
│  • אסור לקרוא ב-main context — המסמך עלול           │
│    להיות גדול (מאות KB) ולהרוס את ה-context          │
│                                                      │
│  📝 OUTPUT = קבצי epics/ בלבד!                      │
│  • .claude/memory/epics/XX-name.md                   │
│  • נכתב רק אחרי אישור Diff                         │
│                                                      │
└──────────────────────────────────────────────────────┘
```

**הזרימה:**
```
DOC_SOURCE ──[קריאה דרך סאב-אייגנט בלבד!]──► סאב-אייגנט קורא את הדרישות
                                                     │
                                                     ▼
                                            מחזיר סיכום דרישות
                                                     │
                                                     ▼
                                      Claude שואל שאלות מפורטות
                                                     │
                                                     ▼
epics/XX.md ◄──[כתיבה אחרי אישור Diff]── כותב אפיון מפורט
```

**3 אופציות בהתחלה (AskUserQuestionTool):**
1. **"יש לי קישור"** → תדביק ונתחיל
2. **"אין לי עדיין"** → לך ליצור מסמך ותחזור
3. **"אפיון מאפס"** → נשאל שאלות מפורטות יותר בלי מסמך

---

## 📚 lessons.md = זיכרון לטווח ארוך

```
┌──────────────────────────────────────────────────────┐
│  .claude/memory/lessons.md                           │
├──────────────────────────────────────────────────────┤
│                                                      │
│  ## שיעור 1: פורמט שאלות                            │
│  • טעות: שאלתי בלי אופציות                          │
│  • תיקון: תמיד AskUserQuestionTool                  │
│    עם מספרים                                        │
│                                                      │
│  ## שיעור 2: Google Doc                             │
│  • טעות: כתבתי ל-Doc לפני אישור                     │
│  • תיקון: תמיד הצג Diff                             │
│    וחכה לאישור                                      │
│                                                      │
│  ## שיעור 3: ilay מעדיף...                          │
│  • עברית בשיחה, אנגלית למונחים טכניים               │
│  • טבלאות עם דוגמאות                                │
│                                                      │
└──────────────────────────────────────────────────────┘
```

**איך זה עובד:**
1. אתה מתקן אותי → אני מזהה שזה שיעור
2. אני מוסיף ל-lessons.md
3. בכל Session חדש → סאב-אייגנט קורא lessons.md
4. לא חוזר על אותה טעות!

**הלולאה:**
```
טעות → זיהוי דפוס → כתיבת כלל → בדיקה → שיפור
   ▲                                           │
   └───────────────────────────────────────────┘
```

---

## 💾 checkpoint.json = שמירה רציפה

**הבעיה:** Claude Code עלול לעשות /compact בכל רגע, או ה-Session עלול להיסגר. בלי שמירה — הכל אבוד!

**הפתרון:** קובץ JSON קטן (~200 tokens) שנשמר אחרי כל תשובה משמעותית:

```
┌──────────────────────────────────────────────────────┐
│  .claude/memory/checkpoint.json                      │
├──────────────────────────────────────────────────────┤
│                                                      │
│  {                                                   │
│    "timestamp": "2026-02-10T14:30:00",              │
│    "epic": "user-authentication",                    │
│    "agent": "architect",                             │
│    "question_number": 5,                             │
│    "completed": ["Q1: Entities", "Q2: Relations",   │
│                   "Q3: APIs", "Q4: Validations"],   │
│    "pending": "Q5: Error Codes",                     │
│    "doc_source": "https://docs.google.com/...",     │
│    "notes": "המשתמש רוצה JWT, לא sessions"          │
│  }                                                   │
│                                                      │
└──────────────────────────────────────────────────────┘
```

**מתי שומרים מה?**

| אירוע | checkpoint | epic file | prd-index |
|--------|-----------|-----------|-----------|
| תשובה משמעותית | ✅ | ✅ | ❌ |
| סיום שלב Agent | ✅ | ✅ | ❌ |
| Epic סגור 100% | ✅ | ✅ | ✅ |
| 50% Context | ✅ + התראה | ✅ | ❌ |
| PreCompact | ✅ | — | — |

**ב-50% Context:**
```
🛑 עצור! → 💾 שמור הכל → 🔄 הצע /compact או Session חדש
```

---

## 📊 prd-index.json = מפת ה-PRD הקיים

**הבעיה:** כל Agent צריך להכיר את כל ה-PRD שכבר נכתב כדי לשאול שאלות חכמות ולזהות קישורים — אבל בלי לשרוף את כל ה-Context!

**הפתרון:** קובץ JSON קומפקטי (~500 tokens) שמכיל את "המפה" של כל מה שקיים:

```
┌──────────────────────────────────────────────────────┐
│  .claude/memory/prd-index.json                       │
├──────────────────────────────────────────────────────┤
│                                                      │
│  {                                                   │
│    "epics_completed": 2,                             │
│    "epics": {                                        │
│      "user-auth": {                                  │
│        "entities": ["User", "Role", "Session"],     │
│        "apis": ["/api/auth/login", "/api/users"],   │
│        "relations": ["User->Role (N:N)"]            │
│      },                                              │
│      "product-catalog": {                            │
│        "entities": ["Product", "Category"],          │
│        "apis": ["/api/products"],                    │
│        "relations": ["Product->Category (N:1)"]     │
│      }                                               │
│    },                                                │
│    "global_entities": ["User", "Role", "Product"],  │
│    "cross_epic_relations": [                         │
│      "Product->User (created_by)"                    │
│    ]                                                 │
│  }                                                   │
│                                                      │
└──────────────────────────────────────────────────────┘
```

**איך Agent משתמש בזה:**

```
┌─────────────────────────────────────────────────────────┐
│  🎯 Session מתחיל                                       │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  1. קורא prd-index.json                                │
│     "יש 2 epics: user-auth, product-catalog"           │
│                                                         │
│  2. משתמש: "בוא נאפיין מערכת הזמנות"                   │
│                                                         │
│  3. Architect שואל שאלה חכמה:                           │
│     "ראיתי שיש לנו Entity של Product ו-User.           │
│      האם הזמנה מקושרת למשתמש ולמוצרים ספציפיים?"       │
│                                                         │
│  4. זיהוי קישורים אוטומטי:                              │
│     "⚠️ ה-epic הזה ישפיע על: user-auth, product-catalog"│
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**היתרונות:**
- ~500 tokens במקום לקרוא את כל ה-PRD (אלפי tokens)
- כל Agent מכיר את ה"מפה" של המערכת
- שאלות חכמות מבוססות על מה שקיים
- זיהוי קישורים אוטומטי בין epics

---

## 🔍 Cross-Review = בקרת איכות (7 בדיקות)

**לפני שכותבים לקובץ epic**, עוברות 7 בדיקות חובה:

```
┌──────────────────────────────────────────────────────┐
│                  🔍 Cross-Review                     │
├──────────────────────────────────────────────────────┤
│                                                      │
│  1. ✅ PM Review                                     │
│     כל User Story מכוסה באפיון?                      │
│                                                      │
│  2. ✅ Architect Review                              │
│     עקביות טכנית — Entities מתאימים ל-APIs?          │
│                                                      │
│  3. ✅ Frontend Review                               │
│     כל endpoint מופיע ב-UI? כל state מטופל?         │
│                                                      │
│  4. ✅ Analytics Events (מינימום 12!)                │
│     כל פעולה משמעותית מתועדת — page view,           │
│     form submit, click, error                        │
│                                                      │
│  5. ✅ SEO Metadata                                  │
│     כל עמוד public — title, description, og:tags    │
│                                                      │
│  6. ✅ i18n Consistency                              │
│     כל הודעה בעברית ובאנגלית                        │
│                                                      │
│  7. ✅ Deferred Documentation                        │
│     מה נדחה לעתיד — מתועד ומנומק                    │
│                                                      │
├──────────────────────────────────────────────────────┤
│  📊 סיכום: X פערים נמצאו / Y נסגרו / Z נדחו        │
│                                                      │
│  ⚠️ יש סתירות? → AskUserQuestionTool → תיקון        │
│  ✅ הכל חלק? → Diff → אישור → כתיבה לקובץ          │
│                                                      │
└──────────────────────────────────────────────────────┘
```

---

## 🏗️ מבנה הקבצים

```
.claude/
├── CLAUDE.md                    ← 🧠 ה"מוח" — 18 כללי ברזל
├── settings.json                ← 3 Hooks (SessionStart, PreCompact, Stop)
├── settings.local.json          ← הרשאות WebFetch
│
├── scripts/
│   └── statusline.sh            ← אחוז Context בצבעים ב-CLI
│
├── memory/                      ← 💾 זיכרון מתמשך
│   ├── checkpoint.json          ← ~200 tokens — איפה עצרנו
│   ├── prd-index.json           ← ~500 tokens — מפת ה-PRD
│   ├── lessons.md               ← שיעורים שנלמדו
│   ├── session-init.json        ← verification מסאב-אייגנט
│   └── epics/                   ← 📄 אפיונים מוכנים לפיתוח
│       ├── 01-user-auth.md
│       └── 02-product-catalog.md
│
└── skills/prd-engine/           ← ⚙️ מנוע ה-Skill
    ├── SKILL.md                 ← Main Orchestrator
    ├── config/
    │   └── workflow.json        ← הגדרות workflow (v2.1.0)
    ├── agents/
    │   ├── product-manager/
    │   │   └── SKILL.md         ← 9 שאלות עסקיות
    │   ├── architect/
    │   │   └── SKILL.md         ← 8 שאלות טכניות
    │   └── frontend/
    │       └── SKILL.md         ← 11+1 שאלות UI/UX
    ├── rules/
    │   ├── INDEX.md
    │   ├── 01-questions-format.md
    │   ├── 02-review-crosscheck.md
    │   └── 03-reflection.md
    ├── templates/
    │   ├── epic-template.md     ← תבנית Epic (Parts A-D)
    │   ├── checkpoint.json
    │   ├── prd-index.json
    │   ├── landing-page-guide.md  ← מדריך Landing Page (10 sections)
    │   └── landing-page-anatomy.jpg
    └── hooks/
        ├── startup.sh           ← SessionStart
        ├── pre-compact.sh       ← PreCompact
        └── auto-checkpoint.sh   ← Stop (Reflection)
```

---

## ⚡ Hooks = אוטומציה

3 Hooks שרצים אוטומטית — בלי שהמשתמש צריך לעשות משהו:

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ SessionStart│    │ PreCompact  │    │    Stop      │
│             │    │             │    │             │
│ startup.sh  │    │pre-compact  │    │auto-        │
│             │    │   .sh       │    │checkpoint.sh│
│             │    │             │    │             │
│ מה עושה:   │    │ מה עושה:   │    │ מה עושה:   │
│ מדפיס      │    │ שומר       │    │ שומר       │
│ "PRD-Engine │    │ checkpoint  │    │ checkpoint  │
│ v2.1.0      │    │ עם timestamp│    │ + reflection│
│ מוכן!"     │    │ לפני compact│    │ + lessons   │
└─────────────┘    └─────────────┘    └─────────────┘
     │                   │                   │
     ▼                   ▼                   ▼
  Session             /compact             Session
  מתחיל               קורה                 נגמר
```

**למה Hooks חשובים?**
- **SessionStart:** מודיע שה-engine פעיל
- **PreCompact:** שומר מצב לפני ש-compact מוחק את ההיסטוריה
- **Stop:** שומר כל מה שנותר + רושם reflection לשיפור עתידי

---

## 🔒 18 כללי ברזל — סקירה מהירה

| # | כלל | בקצרה |
|---|------|--------|
| 0 | סאב-אייגנטים | Sonnet בלבד + DOC_SOURCE רק דרך סאב-אייגנט |
| 1 | שאלות מובנות | AskUserQuestionTool + אופציות + 🎯 השלכות |
| 2 | מודולריות | 500 שורות מקסימום, כל Agent בתחומו |
| 3 | שמירה רציפה | checkpoint אחרי כל תשובה + מטריצת שמירה |
| 4 | אפס קצוות פתוחים | כל פרט מוגדר, כל error message כתוב |
| 5 | Plan Mode | חובה לפני משימה משמעותית |
| 6 | Cross-Review | 7 בדיקות חובה לפני כתיבה לקובץ |
| 7 | Sweet Spot | 🟢 MVP / 🔵 עתיד / ❓ משתמש מחליט |
| 8 | Epics = Dev-Ready | כל קובץ epic = מוכן לפיתוח |
| 9 | Diff לפני כתיבה | הצג שינויים + אישור מפורש |
| 10 | גמישות הוליסטית | שאלות SKILL = נקודת פתיחה, Agent מעמיק |
| 11 | לולאת שיפור | lessons.md — לומד מטעויות |
| 12 | קריאת DOC_SOURCE | בכל Session דרך סאב-אייגנט |
| 13 | טעינת PRD Context | prd-index.json לשאלות חכמות |
| 14 | החלפת כובעים | 🎩 הודעה + קריאת SKILL.md |
| 15 | Analytics | מינימום 12 events לכל epic |
| 16 | Design System | colors + typography + spacing חובה |
| 17 | Reflection | בסוף כל session — עדכון lessons.md |

---

## 🎯 Sweet Spot = MVP vs עתיד

**ב-Architect, כל שאלה טכנית מופרדת ל-3 רמות:**

```
┌──────────────────────────────────────────────────────┐
│                                                      │
│  🟢 חובה ל-MVP                                     │
│  בלי זה ה-epic לא עובד                              │
│  דוגמה: "Entity של User עם email + password"        │
│                                                      │
├──────────────────────────────────────────────────────┤
│                                                      │
│  🔵 המלצה לעתיד                                    │
│  יחסוך refactor בהמשך                               │
│  דוגמה: "הוסף שדה role_history לתעד שינויי הרשאות" │
│                                                      │
├──────────────────────────────────────────────────────┤
│                                                      │
│  ❓ המשתמש מחליט                                    │
│  יש 2 דרכים — תבחר                                  │
│  דוגמה: "JWT או Session-based? שניהם עובדים"       │
│                                                      │
└──────────────────────────────────────────────────────┘
```

---

## 📦 Epic = מוצר מוגמר

כל קובץ ב-`epics/` הוא מסמך אפיון עצמאי עם 4 חלקים + סיכום:

```
┌──────────────────────────────────────────────────────┐
│  📄 epics/03-order-system.md                         │
├──────────────────────────────────────────────────────┤
│                                                      │
│  Part A — Business Requirements (PM)                 │
│  ├─ User Stories (2-4)                               │
│  ├─ Acceptance Criteria (8-12, מקוטלגים)             │
│  ├─ User Roles Table                                 │
│  ├─ Edge Cases / Funnel                              │
│  ├─ KPIs Tables                                      │
│  ├─ 2030 Recommendations                             │
│  └─ Key Decisions                                    │
│                                                      │
│  Part B — Technical Architecture (Architect)         │
│  ├─ Entities (שדות, indexes, rules, edge cases)     │
│  ├─ Relations (עם FK behavior)                       │
│  ├─ API Endpoints (Auth + Rate Limit)                │
│  ├─ Validations (HE + EN)                            │
│  ├─ Error Codes (7 קטגוריות)                         │
│  ├─ Logging & Monitoring                             │
│  ├─ Dependencies (3 קטגוריות)                        │
│  ├─ 2030 Recommendations                             │
│  └─ Key Decisions                                    │
│                                                      │
│  Part C — Frontend Specification                     │
│  ├─ ASCII Wireframes                                 │
│  ├─ Error Display — 3 Levels (Inline/Banner/Toast)  │
│  ├─ Responsive Breakpoints                           │
│  ├─ Accessibility (WCAG AA)                          │
│  ├─ i18n System                                      │
│  ├─ Design System                                    │
│  ├─ 2030 Recommendations                             │
│  └─ Key Decisions                                    │
│                                                      │
│  Part D — Cross-Review (7 בדיקות)                   │
│  ├─ Analytics Events (12+)                           │
│  ├─ SEO Metadata                                     │
│  ├─ i18n Consistency                                 │
│  └─ Review Summary                                   │
│                                                      │
│  Key Decisions (All Agents) — טבלה מאוחדת           │
│                                                      │
└──────────────────────────────────────────────────────┘
```

**היתרון:** המשתמש לוקח את הקובץ → מעביר ל-Cursor / Claude Code / Copilot / Windsurf / Bolt → המפתח מתחיל לפתח ישירות, בלי שאלות נוספות.

---

## 🔄 Workflow מלא — תרחיש מקצה לקצה

```
מתחיל Session
    │
    ▼
┌──────────────────────────────────────────┐
│  קורא CLAUDE.md (כללי ברזל)             │
│  קורא checkpoint.json (אם יש)           │
│  סאב-אייגנט קורא: SKILL.md + rules/     │
│  + lessons.md + prd-index.json + epics/  │
│  + DOC_SOURCE (אם יש) via WebFetch      │
└────────────────────┬─────────────────────┘
                     │
                     ▼
     📊 "יש 2 epics קיימים, ממשיכים?"
                     │
                     ▼
   (מקור + יעד) AskUserQuestionTool שלב 0
                     │
                     ▼
┌──────────────────────────────────────────┐
│  שלב PM: שאלות עסקיות                    │
│  (קורא product-manager/SKILL.md)        │
│                                          │
│  9 שאלות:                                │
│  Q1: מי המשתמש?                          │
│  Q2: איזו בעיה זה פותר?                  │
│  Q3: User Stories                        │
│  Q4: Acceptance Criteria                 │
│  Q5: עדיפות                              │
│  Q6: Cancel/Error + Funnel               │
│  Q7: User Roles Table                    │
│  Q8: KPIs                                │
│  Q9: 2030 Recommendations               │
│                                          │
│  צריך לחקור משהו?                        │
│    → Task Tool = Sub-Agent               │
│    → מחזיר תוצאות                        │
│    → ממשיך לשאול                         │
└────────────────────┬─────────────────────┘
                     │
                     ▼
     🎩 "עוברים ל-Architect!"
                     │
                     ▼
┌──────────────────────────────────────────┐
│  שלב Architect: שאלות טכניות            │
│  (קורא architect/SKILL.md)              │
│                                          │
│  ◻ "יש כבר Entity של User ב-prd-index, │
│     נקשר אליו או ניצור חדש?"           │
│                                          │
│  8 שאלות: Entities, Relations, APIs,    │
│  Validations, Error Codes,              │
│  Logging, Dependencies, 2030 Recs       │
│                                          │
│  Sweet Spot: 🟢 MVP / 🔵 עתיד / ❓      │
└────────────────────┬─────────────────────┘
                     │
                     ▼
     🎩 "עוברים ל-Frontend!"
                     │
                     ▼
┌──────────────────────────────────────────┐
│  שלב Frontend: שאלות UI                  │
│  (קורא frontend/SKILL.md)               │
│                                          │
│  Q0: יש תמונת reference?                │
│  Q1-Q11: Layout, Errors, Loading,       │
│  Responsive, A11y, i18n, Design System  │
└────────────────────┬─────────────────────┘
                     │
                     ▼
┌──────────────────────────────────────────┐
│  🔍 Cross-Review — 7 בדיקות             │
│  סתירות? → AskUserQuestionTool → תיקון  │
│  ✅ הכל חלק? → המשך                     │
└────────────────────┬─────────────────────┘
                     │
                     ▼
     Diff → אישור → כתיבה ל-epics/XX.md
                     │
                     ▼
┌──────────────────────────────────────────┐
│  עדכון checkpoint.json                   │
│  עדכון prd-index.json (epic חדש!)       │
│  ✅ "Epic מוכן לפיתוח!"                 │
└────────────────────┬─────────────────────┘
                     │
                     ▼
     50% Context? → שמור → Session חדש
```

---

## 🧠 גמישות הוליסטית = שאלות חכמות

**השאלות ב-SKILL.md הן נקודת פתיחה, לא רשימה סגורה!**

```
┌──────────────────────────────────────────────────────┐
│                                                      │
│  📋 SKILL.md = מינימום חובה + כיוון                  │
│  🧠 ה-Agent = מעמיק לפי הצורך                       │
│                                                      │
│  דוגמה:                                              │
│                                                      │
│  PM שואל (מ-SKILL.md): "מי המשתמש?"                 │
│  משתמש עונה: "מנהל חנות"                             │
│                                                      │
│  PM ממשיך (מהאינטליגנציה שלו):                       │
│  ┌─                                                  │
│  │ "האם מנהל חנות יכול לנהל יותר מחנות אחת?"       │
│  │ "האם יש הבדל בין מנהל פנימי לחיצוני?"           │
│  │ "האם מנהל חנות רואה את כל העובדים?"              │
│  └─                                                  │
│                                                      │
│  ✅ שאל חובה מ-SKILL.md                              │
│  ✅ הוסף שאלות לפי הצורך                             │
│  ✅ העמק כשיש עמימות                                 │
│  ❌ אל תתעלם משאלות חובה                             │
│  ❌ אל תשאל שאלות לא רלוונטיות                      │
│                                                      │
└──────────────────────────────────────────────────────┘
```

---

## 4️⃣ אפס קצוות פתוחים

**כל פרט חייב להיות מוגדר — לא "יהיה משהו":**

| ❌ לא מספיק | ✅ מספיק |
|------------|---------|
| "יוצג הודעת שגיאה" | "יוצג: 'אירעה שגיאה בשמירה. אנא נסה שוב.'" |
| "הכפתור יעשה submit" | "לחיצה: 1) spinner, 2) POST /api/x, 3) toast ירוק / הודעה אדומה" |
| "יהיה validation" | "שם — חובה, מינ׳ 2 תווים. אימייל — פורמט. טלפון — 10 ספרות." |
| "המשתמש יוכל למחוק" | "popup 'האם למחוק?' → כפתור אדום → toast 'נמחק בהצלחה'" |

---

PRD-Engine System v2.1.0 | Multi-Agent Architecture Guide
